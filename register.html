<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Register Patient</title>
<style>
/* Use your existing CSS */
body { font-family: Arial, sans-serif; background: #f4f6f8; margin: 0; padding: 0; }
/* ... all your existing CSS ... */
</style>
</head>
<body>

<header>
    <h1>Register Patient</h1>
</header>

<div class="container">
<h2>Register New Patient</h2>
<div class="form-row">
    <div class="form-group">
        <label>Full Name</label>
        <input type="text" id="regPatientName" placeholder="Enter full name" required>
    </div>
    <div class="form-group">
        <label>Age</label>
        <input type="number" id="regPatientAge" placeholder="Age" required>
    </div>
    <div class="form-group">
        <label>Contact Number</label>
        <input type="text" id="regContactNumber" placeholder="Enter contact number" required>
    </div>
</div>

<button id="registerBtn">Register Patient</button>

<h3>Registered Patients</h3>
<table id="registeredTable">
    <thead>
        <tr>
            <th>Full Name</th>
            <th>Age</th>
            <th>Contact Number</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
</div>

<!-- Firebase SDK Modular -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, where } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyBWaH3wC79rB2qGtOqYYWogb4nlPbPCoqs",
    authDomain: "patient-system-97412.firebaseapp.com",
    projectId: "patient-system-97412",
    storageBucket: "patient-system-97412.appspot.com",
    messagingSenderId: "988662086004",
    appId: "1:988662086004:web:3427af061c370a87521421",
    measurementId: "G-VXTREJV1FG"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// DOM Elements
const registerBtn = document.getElementById("registerBtn");
const tableBody = document.getElementById("registeredTable").querySelector("tbody");

// Load patients
async function loadRegisteredPatients() {
    tableBody.innerHTML = '';
    const querySnapshot = await getDocs(collection(db, "patients"));
    querySnapshot.forEach(docSnap => {
        const p = docSnap.data();
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${p.name}</td>
            <td>${p.age}</td>
            <td>${p.contact}</td>
            <td><button class="delete-btn" data-id="${docSnap.id}">Delete</button></td>
        `;
        tableBody.appendChild(row);
    });

    // Add delete listeners
    document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.addEventListener("click", async () => {
            const id = btn.getAttribute("data-id");
            await deleteDoc(doc(db, "patients", id));
            loadRegisteredPatients();
        });
    });
}

// Register patient
registerBtn.addEventListener("click", async () => {
    const name = document.getElementById("regPatientName").value.trim();
    const age = document.getElementById("regPatientAge").value.trim();
    const contact = document.getElementById("regContactNumber").value.trim();

    if (!name || !age || !contact) {
        alert("Please fill in all fields!");
        return;
    }

    // Check if patient already exists
    const q = query(collection(db, "patients"), where("name", "==", name));
    const querySnapshot = await getDocs(q);
    if (!querySnapshot.empty) {
        alert("Patient already registered!");
        return;
    }

    await addDoc(collection(db, "patients"), { name, age, contact });

    document.getElementById("regPatientName").value = '';
    document.getElementById("regPatientAge").value = '';
    document.getElementById("regContactNumber").value = '';

    loadRegisteredPatients();
});

// Load table on page load
loadRegisteredPatients();
</script>

</body>
</html>
